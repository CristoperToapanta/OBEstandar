<?xml version="1.0"?>
  <database name="FUNCTION SCACTU_ORDER">
    <function name="SCACTU_ORDER" type="VARCHAR">
      <parameter name="pinstance_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[-- Logistice
	v_ResultStr		VARCHAR2(2000) := '';
	v_Message		TEXT := ''; --OBTG:VARCHAR2--
	-- Variables
	Cur				RECORD;
	vOrderID		VARCHAR2(32);
	vOrder			RECORD;
	vOrderLine		RECORD;
	vDocAction		VARCHAR2(60);
BEGIN
	-- Begin Get Parameters
	FOR Cur IN (
		SELECT *
		FROM ad_ep_instance_para
		WHERE ad_ep_instance_id = PInstance_ID
	) LOOP
		IF Cur.ParameterName = 'Record_ID' THEN
			vOrderID := Cur.P_String;
		ELSEIF Cur.ParameterName = 'DocAction' THEN
			vDocAction := Cur.P_String;
		END IF;	
	END LOOP;
	-- Finish Get Parameter
	
	--<<BEGIN_PROCESS>>
	SELECT * INTO vOrder FROM c_order WHERE c_order_id = vOrderID;

	IF vOrder.issotrx = 'Y' THEN
	
		IF vDocAction = 'CO' THEN

			FOR vOrderLine IN (
				SELECT ol.c_orderline_id, ol.discount
				FROM c_orderline ol
				WHERE ol.c_order_id = vOrderID AND COALESCE(ol.discount,0) > 0
			) LOOP
				UPDATE c_invoiceline SET em_sseed_discount = vOrderLine.discount
				WHERE c_orderline_id = vOrderLine.c_orderline_id;
			END LOOP;
		
		END IF;
		
	END IF;

	--<<FINISH_PROCESS>>
		
	RETURN v_ResultStr;
END SCACTU_ORDER
]]></body>
    </function>
  </database>
